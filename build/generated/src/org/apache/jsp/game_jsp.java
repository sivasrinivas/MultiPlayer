package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import javacode.Client;

public final class game_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final JspFactory _jspxFactory = JspFactory.getDefaultFactory();

  private static java.util.List<String> _jspx_dependants;

  private org.glassfish.jsp.api.ResourceInjector _jspx_resourceInjector;

  public java.util.List<String> getDependants() {
    return _jspx_dependants;
  }

  public void _jspService(HttpServletRequest request, HttpServletResponse response)
        throws java.io.IOException, ServletException {

    PageContext pageContext = null;
    HttpSession session = null;
    ServletContext application = null;
    ServletConfig config = null;
    JspWriter out = null;
    Object page = this;
    JspWriter _jspx_out = null;
    PageContext _jspx_page_context = null;

    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;
      _jspx_resourceInjector = (org.glassfish.jsp.api.ResourceInjector) application.getAttribute("com.sun.appserv.jsp.resource.injector");

      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");

//creates an object for client and set it as session attribute for further use of communicating with server
    Client client = new Client();
    int id = client.connect();
    String player = "player" + id;
    session.setAttribute("client", client);
    session.setAttribute("id", id);
    session.setAttribute("player", player);

      out.write("\n");
      out.write("<html>\n");
      out.write("    <head>\n");
      out.write("        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n");
      out.write("        <title>Game Page</title>\n");
      out.write("\n");
      out.write("        <link rel=\"stylesheet\" type=\"text/css\" href=\"resources/style.css\"></link>\n");
      out.write("        <script type=\"text/javascript\" src=\"resources/jquery.js\"></script>\n");
      out.write("        <script type=\"text/javascript\" src=\"resources/jquery.min.js\"></script>\n");
      out.write("        <script type=\"text/javascript\" src=\"resources/jquery.timer.js\"></script>\n");
      out.write("        <script type=\"text/javascript\" src=\"resources/imagescript.js\"></script>\n");
      out.write("        <script type=\"text/javascript\">\n");
      out.write("            var playersTimer;\n");
      out.write("            var score = 0;\n");
      out.write("            var count = 0;\n");
      out.write("            keys1 = [];\n");
      out.write("            keys2 = [];\n");
      out.write("            values1 = [];\n");
      out.write("            values2 = [];\n");
      out.write("            $(document).ready(function() {\n");
      out.write("                $(\"#table\").hide();\n");
      out.write("                $(\"#dummytable\").hide();\n");
      out.write("                // Wait for the start command from server, if it receives game starts automatically\n");
      out.write("                $.post(\"comm.jsp\", {command: \"wait\"}, function(data) {\n");
      out.write("                    var resp = data.toString();\n");
      out.write("                    resp = resp.trim();\n");
      out.write("                    // Game starts when start command is received from server.\n");
      out.write("                    if (resp === \"start\") {\n");
      out.write("                        $(\"#startButton\").hide();\n");
      out.write("                        var seconds = 3, second = 1;\n");
      out.write("                        var interval = setInterval(function() {\n");
      out.write("                            document.getElementById(\"gamestart\").innerHTML = 'Game Starts in  ' + (seconds - second) + ' seconds';\n");
      out.write("                            if (second >= seconds) {\n");
      out.write("                                clearInterval(interval);\n");
      out.write("                                $(\"#gamestart\").hide();\n");
      out.write("                                $(\"#dummytable\").show();\n");
      out.write("                                //get the random number from server to shuffle tiles\n");
      out.write("                                setSeed();\n");
      out.write("                                //once game starts, timer will be started\n");
      out.write("                                timer.play();\n");
      out.write("                            }\n");
      out.write("                            second++;\n");
      out.write("                        }, 1000);\n");
      out.write("                    }\n");
      out.write("                    //Once the game starts, the player needs to wait for the next session\n");
      out.write("                    else if (resp === \"inprogress\") {\n");
      out.write("                        alert(\"Game in progress...try after sometime...\");\n");
      out.write("                    }\n");
      out.write("                });\n");
      out.write("                //start button clicked, start command sent to server via comm.jsp\n");
      out.write("                $(\"#startButton\").click(function() {\n");
      out.write("                    $.post(\"comm.jsp\", {command: \"start\"}, function(data) {\n");
      out.write("                        var resp = data.toString().trim();\n");
      out.write("                        if (resp === \"inprogress\") {\n");
      out.write("                            alert(\"Game in progress...try after sometime...\");\n");
      out.write("                        }\n");
      out.write("                    });\n");
      out.write("                });\n");
      out.write("\n");
      out.write("                var timer = $.timer(function() {\n");
      out.write("                    count++;\n");
      out.write("                    $('.count').html(count);\n");
      out.write("                    if (count === 1) {\n");
      out.write("                        timing();\n");
      out.write("                        //tile images and corresponding rear numbers displayed\n");
      out.write("                        setDummyImages(keys1, values1);\n");
      out.write("                    }\n");
      out.write("                    if (count === 15) {\n");
      out.write("                        $(\"#dummytable\").hide();\n");
      out.write("                        $(\"div.imgdiv\").css({\"height\": \"100px\", \"width\": \"100px\"});\n");
      out.write("                        //tiles will be shuffled and new table with shuffled tiles will be shown\n");
      out.write("                        $(\"#table\").show(1000);\n");
      out.write("                        setImages(keys2, values2);\n");
      out.write("                    }\n");
      out.write("                    if (count === 40) {\n");
      out.write("                        //game ends when count hits 40\n");
      out.write("                        clearInterval(playersTimer);\n");
      out.write("                        timer.stop();\n");
      out.write("                        stopPlaying();\n");
      out.write("                    }\n");
      out.write("\n");
      out.write("                });\n");
      out.write("                timer.set({time: 1000, autostart: false});\n");
      out.write("                //Player decides to leave, clicks exit button. exit command sent to server to close client socket\n");
      out.write("                $(\"#exit\").click(function() {\n");
      out.write("                    var result = window.confirm(\"Do you really want to exit?\");\n");
      out.write("                    if (result == true) {\n");
      out.write("                        clearInterval(playersTimer);\n");
      out.write("                        $.post(\"comm.jsp\", {command: \"exit\"}, function(data) {\n");
      out.write("\n");
      out.write("                        });\n");
      out.write("                        timer.stop();\n");
      out.write("                        window.close();\n");
      out.write("                    } else {\n");
      out.write("                    }\n");
      out.write("                });\n");
      out.write("            });\n");
      out.write("        </script>\n");
      out.write("        <script type=\"text/javascript\">\n");
      out.write("            \n");
      out.write("            //timer to update players list concurrently\n");
      out.write("            function timing(){\n");
      out.write("                playersTimer = setInterval(function(){\n");
      out.write("                    $.post(\"comm.jsp\",{command:\"players\"},function(data){\n");
      out.write("                        var playersList = data.toString();\n");
      out.write("                        playersList = playersList.trim();\n");
      out.write("                        $(\"#playersList\").html(playersList);\n");
      out.write("                    });\n");
      out.write("                },1000);\n");
      out.write("            }\n");
      out.write("            //shuffles the tiles by getting the seed from server.\n");
      out.write("            function setSeed() {\n");
      out.write("                $.post(\"comm.jsp\", {command: \"seed\"}, function(data) {\n");
      out.write("                    \n");
      out.write("                    shuffle = function(o){ //v1.0\n");
      out.write("                        for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);\n");
      out.write("                        return o;\n");
      out.write("                    };\n");
      out.write("\n");
      out.write("                    var seed = data.toString();\n");
      out.write("                    seed = seed.trim();\n");
      out.write("                    keys1.push(\"aaple\", \"banana\", \"clouds\", \"deer\", \"dog\", \"eagle\", \"light\", \"tea\", \"train\", \"zebra\");\n");
      out.write("                    //values1.push(1, 2, 3, 4, 5, 1, 2, 3, 4, 5);\n");
      out.write("                    values1 = shuffle([1,2,3,4,5,1,2,3,4,5]);\n");
      out.write("                    keys2.push(\"aaple\", \"banana\", \"clouds\", \"deer\", \"dog\", \"eagle\", \"light\", \"tea\", \"train\", \"zebra\");\n");
      out.write("                    values2 = values1;\n");
      out.write("                    \n");
      out.write("                    var temp1, temp2;\n");
      out.write("                    for (var i = 0; i < 10; i++) {\n");
      out.write("                        temp1 = keys2[parseInt(seed.substr(i, 1))];\n");
      out.write("                        keys2[parseInt(seed.substr(i, 1))] = keys2[i];\n");
      out.write("                        keys2[i] = temp1;\n");
      out.write("\n");
      out.write("                        temp2 = values2[parseInt(seed.substr(i, 1))];\n");
      out.write("                        values2[parseInt(seed.substr(i, 1))] = values2[i];\n");
      out.write("                        values2[i] = temp2;\n");
      out.write("                    }\n");
      out.write("                    alert(values1+\"\\n\"+keys1+\"\\n\"+values2+\"\\n\"+keys2)\n");
      out.write("                });\n");
      out.write("            }\n");
      out.write("            //alerting the score and sending the score to results.jsp afetr game ends\n");
      out.write("            function stopPlaying() {\n");
      out.write("                $.post(\"comm.jsp\", {command: \"gameend\", sc: score}, function(data) {\n");
      out.write("                    //                    var data = data.toString().trim();\n");
      out.write("                    alert(\"Your score is :\" + score);\n");
      out.write("                    //score will be shown and redirects to results page automatically\n");
      out.write("                    window.location = \"results.jsp\";\n");
      out.write("                });\n");
      out.write("            }\n");
      out.write("            \n");
      out.write("        </script>\n");
      out.write("\n");
      out.write("    </head>\n");
      out.write("    <body>\n");
      out.write("        <div id=\"container\" style=\"width:80%;height:100%;border:solid;border-width:2px;\">\n");
      out.write("            <div id=\"header\" align=\"top\" style=\"width:100%;height:10%;border:solid;border-width:2px;background-color: #AD7460;\">\n");
      out.write("                <table style=\"width: 100%\">\n");
      out.write("                    <tr ><td><h1><div id=\"welcome\" style=\"width: 70%;height: 100%;text-align: center;\">Welcome ");
      out.print( player);
      out.write("</div></h1></td>   \n");
      out.write("                        <td><h3><div id=\"gamestart\" style=\"width: 20%;height: 100%;text-align: right;\" ></div></h3></td>\n");
      out.write("                        <td> <h1> <div class=\"count\" style=\"width: 20%;height: 100%;text-align: right;\"></div></h1></td>\n");
      out.write("                    </tr>\n");
      out.write("                </table>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("\n");
      out.write("            <div id=\"main\" style=\"width:100%;height:80%;\">\n");
      out.write("                <div id=\"tableDiv\" style=\"width:70%;height:100%;border:solid;border-width:2px;float:left;background-color: #F5D5BC;\">\n");
      out.write("\n");
      out.write("                    <table id=\"table\" style=\"alignment-adjust: middle;\">\n");
      out.write("                        <tbody>\n");
      out.write("                            <tr>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"img0\" class=\"image\" src=\"resources/card.jpg\" onclick=\"showImage(0);\"/>\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"img1\" class=\"image\" src=\"resources/card.jpg\" onclick=\"showImage(1);\"/>\n");
      out.write("                                    </div>\n");
      out.write("\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"img2\" class=\"image\" src=\"resources/card.jpg\" onclick=\"showImage(2);\" />\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"img3\" class=\"image\" src=\"resources/card.jpg\" onclick=\"showImage(3);\" />\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"img4\" class=\"image\" src=\"resources/card.jpg\" onclick=\"showImage(4);\" />\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                            </tr>\n");
      out.write("                            <tr>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"img5\" class=\"image\" src=\"resources/card.jpg\" onclick=\"showImage(5);\" />\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"img6\" class=\"image\" src=\"resources/card.jpg\" onclick=\"showImage(6);\" />\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"img7\" class=\"image\" src=\"resources/card.jpg\" onclick=\"showImage(7);\" />\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"img8\" class=\"image\" src=\"resources/card.jpg\" onclick=\"showImage(8);\" />\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"img9\" class=\"image\" src=\"resources/card.jpg\" onclick=\"showImage(9);\" />\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                            </tr>\n");
      out.write("                        </tbody>\n");
      out.write("                    </table>\n");
      out.write("\n");
      out.write("                    <br><br>\n");
      out.write("                    <table id=\"dummytable\" style=\"alignment-adjust: middle;\" >\n");
      out.write("                        <tbody>\n");
      out.write("                            <tr>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"dimg0\" class=\"image\" src=\"resources/card.jpg\"/>\n");
      out.write("                                        <br>\n");
      out.write("                                        <img id=\"dnimg0\" class=\"image\" src=\"resources/tick.jpg\"/>\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"dimg1\" class=\"image\" src=\"resources/card.jpg\"/>\n");
      out.write("                                        <br>\n");
      out.write("                                        <img id=\"dnimg1\" class=\"image\" src=\"resources/tick.jpg\"/>\n");
      out.write("                                    </div>\n");
      out.write("\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"dimg2\" class=\"image\" src=\"resources/card.jpg\"/>\n");
      out.write("                                        <br>\n");
      out.write("                                        <img id=\"dnimg2\" class=\"image\" src=\"resources/tick.jpg\"/>\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"dimg3\" class=\"image\" src=\"resources/card.jpg\"/>\n");
      out.write("                                        <br>\n");
      out.write("                                        <img id=\"dnimg3\" class=\"image\" src=\"resources/tick.jpg\"/>\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"dimg4\" class=\"image\" src=\"resources/card.jpg\"/>\n");
      out.write("                                        <br>\n");
      out.write("                                        <img id=\"dnimg4\" class=\"image\" src=\"resources/tick.jpg\"/>\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                            </tr>\n");
      out.write("                            <tr>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"dimg5\" class=\"image\" src=\"resources/card.jpg\"/>\n");
      out.write("                                        <br>\n");
      out.write("                                        <img id=\"dnimg5\" class=\"image\" src=\"resources/tick.jpg\"/>\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"dimg6\" class=\"image\" src=\"resources/card.jpg\"/>\n");
      out.write("                                        <br>\n");
      out.write("                                        <img id=\"dnimg6\" class=\"image\" src=\"resources/tick.jpg\"/>\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"dimg7\" class=\"image\" src=\"resources/card.jpg\"/>\n");
      out.write("                                        <br>\n");
      out.write("                                        <img id=\"dnimg7\" class=\"image\" src=\"resources/tick.jpg\"/>\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"dimg8\" class=\"image\" src=\"resources/card.jpg\"/>\n");
      out.write("                                        <br>\n");
      out.write("                                        <img id=\"dnimg8\" class=\"image\" src=\"resources/tick.jpg\"/>\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                                <td>\n");
      out.write("                                    <div class=\"imgdiv\">\n");
      out.write("                                        <img id=\"dimg9\" class=\"image\" src=\"resources/card.jpg\"/>\n");
      out.write("                                        <br>\n");
      out.write("                                        <img id=\"dnimg9\" class=\"image\" src=\"resources/tick.jpg\"/>\n");
      out.write("                                    </div>\n");
      out.write("                                </td>\n");
      out.write("                            </tr>\n");
      out.write("                        </tbody>\n");
      out.write("                    </table>\n");
      out.write("\n");
      out.write("\n");
      out.write("                </div>\n");
      out.write("                <div id=\"players\" style=\"width:29%;height:100%;border:solid;border-width:2px;float:right;background-color: #D6A354;\">\n");
      out.write("                    <h1>Players List</h1>\n");
      out.write("                    <div id=\"playersList\"></div>\n");
      out.write("                    <!--<iframe src=\"players.jsp\"></iframe>-->\n");
      out.write("                </div>\n");
      out.write("\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <div id=\"footer\" align=\"bottom\" style=\"width:100%;height:10%;border:solid;border-width:2px;background-color:#A84A5C\">\n");
      out.write("\n");
      out.write("                <center>  <input type=\"button\" name=\"startButton\" id=\"startButton\" value=\"Start Game\" \"/></center>\n");
      out.write("                <center><input id=\"exit\" style=\"alignment-adjust: central;\" type=\"button\" value=\"Exit\"></input></center>\n");
      out.write("                <h2><div id=\"timer\"></div></h2>\n");
      out.write("                <br>\n");
      out.write("                <!--end of footer-->\n");
      out.write("            </div>\n");
      out.write("            <!--End of container-->\n");
      out.write("        </div>\n");
      out.write("    </body>\n");
      out.write("</html>\n");
    } catch (Throwable t) {
      if (!(t instanceof SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          out.clearBuffer();
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
